<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ëŒ€ë¦¬ì  ì „ìš© í˜ì´ì§€</title>

<style>
body {
  background:#0f1115;
  color:#e0e0e0;
  font-family:Malgun Gothic,Arial;
  margin:0;
}

.hidden { display:none !important; }

#login-section {
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  background:#0f1115;
}

.login-box {
  background: #161a20;
  padding: 30px;
  border-radius: 10px;
  width: 460px; 
  box-shadow: 0 0 30px rgba(0,0,0,.8);
  text-align: center;

  /* --- ì„¸ë¡œ ì •ë ¬ ì„¤ì • --- */
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
}

/* ê³µí†µ ìŠ¤íƒ€ì¼: inputê³¼ buttonì˜ í¬ê¸°ë¥¼ ë˜‘ê°™ì´ ë§ì¶¤ */
input, button {
  width: 300px;
  height: 45px;
  box-sizing: border-box;
  border-radius: 6px;
  font-size: 16px;
  text-align: center;
}

input {
  background: #0f1115;
  border: 1px solid #2a2f3a;
  color: #fff;
  padding: 0 12px;
}

button {
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: 0.2s;
}

/* ê° ë²„íŠ¼ë³„ ìƒ‰ìƒë§Œ ë”°ë¡œ ì„¤ì • */
.login-btn { 
  background: #2d6cdf; 
  color: #fff; 
}
.login-btn:hover { background: #2458b8; }

/* ë©”ì¸ í™”ë©´ì˜ ì‹œíŠ¸ ì „í™˜ ë²„íŠ¼ */
.btn-swap {
  width: auto;
  min-width: 120px;
  padding: 0 15px;
  height: 45px;
  font-size: 14px;
}

.protect-btn {
  margin-top: 10px;
  background: #0f1115;
  border: 2px solid #ff5252;
  color: #ff5252;
  font-weight: bold;
}
.protect-btn:hover { 
  background: #ff5252; 
  color: #0f1115; 
}

/* ê²€ìƒ‰ì°½ ì „ìš© ì„¤ì • (ë…¸ë€ ë°°ê²½ ìœ ì§€) */
#searchInput {
  background: #ffeb3b;
  color: #000;
  border: 1px solid #fdd835;
}

/* í•©ì³ì§„ ê²€ìƒ‰ì°½ ìŠ¤íƒ€ì¼ ë° placeholder ìƒ‰ìƒ */
#searchInput::placeholder {
  color: #444;
}

#content {
  padding:20px;
}

#top-bar {
  display:flex;
  justify-content:flex-start;
  align-items:center;
  margin-bottom:10px;
}

#sheet-name { font-size:2em; font-weight:bold; }

.table-wrap { overflow-x:auto; }

table {
  border-collapse:collapse;
  width:max-content;
  min-width:100%;
}

th, td {
  padding:8px 12px;
  border-bottom:1px solid #333;
  white-space:nowrap;
}

th {
  background:#202b38;
  position:sticky;
  top:0;
  z-index:2; /* ìŠ¤í‹°í‚¤ í—¤ë”ê°€ í…Œì´ë¸” ì…€ ìœ„ì— ë‚˜ì˜¤ë„ë¡ */
}

td:hover {
  white-space:normal;
  background:#2a3a4a;
}

/* ê²€ìƒ‰ë°•ìŠ¤: display:flexìœ¼ë¡œ gapì´ ë™ì‘í•˜ë„ë¡ í•˜ê³  ë„ˆë¹„ ì„¤ì • ì¶”ê°€ */
#search-box {
  display:flex;
  width:30ch;
  gap:10px;
  margin:10px 0;
}
</style>
</head>

<body>

<!-- ë¡œê·¸ì¸ -->
  <div id="login-section">
  <div class="login-box">
    <h2>ì—ìŠ¤í‹± ëŒ€ë¦¬ì  ì „ìš© í˜ì´ì§€</h2>
    <input type="password" id="pass" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
           onkeypress="if(event.key==='Enter') login()">
    <button class="login-btn" onclick="login()">ì ‘ì†í•˜ê¸°</button>

    <button id="protectBtn" class="protect-btn"
      onclick="location.href='https://docs.google.com/forms/d/e/1FAIpQLSetZPoILgJ7bKKh4foBkncz_UsZFQTBvX04AMzKoUli0gUXuQ/viewform'">
      ë³´í˜¸ìš”ì²­ì€ ì´ê³³ì„ í´ë¦­
    </button>
  </div>
</div>

<!-- ë©”ì¸ -->
<div id="content" class="hidden">
  
  <div class="control-section">
    <div id="top-bar">
      <button class="btn-swap" onclick="swapSheet()">ğŸ” ì‹œíŠ¸ ê°„ ì „í™˜</button>
      <span id="sheet-name"></span>
    </div>

    <div id="search-box">
      <input type="text" id="searchInput" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥" onkeyup="filterTable()">
    </div>
  </div> <hr class="divider">
  
  <div id="table-container"></div>

</div>

<script>
const WEBAPP_URL = 'https://script.google.com/macros/s/AKfycby9nk4fuhcSM8HAdjqIcj1vt1QfuEWITv_3COPWjajPCTyCXeD0nVMnMXy62vyWAWGJnA/exec';

let currentSheet = 0;
function login() {
  const pw = document.getElementById('pass').value.trim();
  const url = `${WEBAPP_URL}?action=login&password=${encodeURIComponent(pw)}`;

  fetch(url, { method: 'GET' })
  .then(res => res.json())
  .then(res => {
    if (!res || res.success === false) {
      alert('ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜');
      return;
    }

    // If login response includes sheet data, show it
    document.getElementById('login-section').classList.add('hidden');
    document.getElementById('content').classList.remove('hidden');

    const pb = document.getElementById('protectBtn');
    if (pb) pb.remove();

    if (res.name || res.data) {
      document.getElementById('sheet-name').innerText = 'ğŸ“„ ' + (res.name || '');
      makeTable(res.data || []);
    } else {
      loadSheet(0);
    }
  })
  .catch(err => {
    alert('í†µì‹  ì˜¤ë¥˜');
    console.error(err);
  });
}

/* ì‹œíŠ¸ ë¡œë“œ (GET-based) */
function loadSheet(idx) {
  currentSheet = idx;
  document.getElementById('searchInput').value = '';
  const url = `${WEBAPP_URL}?action=getSheetByIndex&index=${encodeURIComponent(idx)}`;

  fetch(url, { method: 'GET' })
  .then(res => res.json())
  .then(res => {
    if (!res || res.success === false) {
      alert('ì‹œíŠ¸ ë¡œë“œ ì‹¤íŒ¨: ' + (res && res.msg ? res.msg : 'unknown'));
      return;
    }
    document.getElementById('sheet-name').innerText = 'ğŸ“„ ' + (res.name || '');
    makeTable(res.data || []);
  })
  .catch(err => {
    alert('í†µì‹  ì˜¤ë¥˜');
    console.error(err);
  });
}

/* ìŠ¤ì™‘ */
function swapSheet() {
  loadSheet(currentSheet === 0 ? 1 : 0);
}

/* í…Œì´ë¸” */
function makeTable(data) {
  let html = '<div class="table-wrap"><table><tbody>';
  data.forEach(r => {
    html += '<tr>';
    r.forEach(c => html += `<td>${c ?? ''}</td>`);
    html += '</tr>';
  });
  html += '</tbody></table></div>';
  document.getElementById('table-container').innerHTML = html;
}

/* ê²€ìƒ‰ */
function filterTable() {
  const q = document.getElementById('searchInput').value.toLowerCase();
  document.querySelectorAll('#table-container tr').forEach(tr=>{
    tr.style.display = tr.innerText.toLowerCase().includes(q) ? '' : 'none';
  });
}
</script>

</body>
</html>
